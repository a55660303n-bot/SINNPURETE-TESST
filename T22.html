<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scent Finder | 香氛診斷</title>
    <style>
        :root { --primary-color: #333; --bg-color: #fcfaf8; }
        body { font-family: "Optima", "serif", "Microsoft JhengHei"; background-color: var(--bg-color); margin: 0; color: var(--primary-color); scroll-behavior: smooth; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }
        .hidden { display: none !important; }
        .card { background: white; padding: 50px 30px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); text-align: center; }
        h2 { font-weight: 300; letter-spacing: 3px; margin-bottom: 40px; line-height: 1.4; }
        .btn { display: block; width: 100%; padding: 18px; margin: 12px 0; border: 1px solid #ddd; background: none; cursor: pointer; transition: 0.4s; font-size: 15px; }
        .btn:hover { border-color: #000; background: #fbfbfb; }
        
        /* 座標圖 */
        .map-wrapper { position: relative; width: 300px; height: 300px; margin: 40px auto; border: 1px solid #eee; background: #fff; }
        .axis-label { position: absolute; font-size: 11px; color: #999; }
        .dot { 
            position: absolute; width: 14px; height: 14px; background: white; 
            border: 2px solid black; border-radius: 50%; transform: translate(-50%, -50%);
            transition: all 2s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 10;
        }

        /* 產品詳情區 */
        #product-detail { margin-top: 50px; padding: 60px 20px; text-align: center; border-top: 1px solid #eee; }
        .product-img { width: 100%; max-width: 300px; border-radius: 4px; margin-bottom: 20px; background: #eee; }
        .buy-link { display: inline-block; background: #000; color: #fff; padding: 15px 40px; text-decoration: none; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="start-page" class="card">
        <h2>FIND YOUR SCENT</h2>
        <p>探索專屬於您的正念香氣</p>
        <button class="btn" onclick="startQuiz()" style="background:#000; color:#fff;">開始分析</button>
    </div>

    <div id="quiz-page" class="card hidden">
        <p id="progress" style="font-size:12px; color:#aaa;"></p>
        <h2 id="question-text"></h2>
        <div id="options-container"></div>
    </div>

    <div id="result-page" class="card hidden">
        <h2>FRAGRANCE MAP</h2>
        <div class="map-wrapper">
            <div id="target-dot" class="dot" style="left: 50%; top: 50%;"></div>
            <div class="axis-label" style="top: -25px; left: 50%; transform: translateX(-50%);">木質調</div>
            <div class="axis-label" style="bottom: -25px; left: 50%; transform: translateX(-50%);">花香調</div>
            <div class="axis-label" style="left: -45px; top: 50%; transform: translateY(-50%);">甜美</div>
            <div class="axis-label" style="right: -45px; top: 50%; transform: translateY(-50%);">清爽</div>
        </div>
        <p id="status-text">正在計算您的專屬香氣...</p>
    </div>

    <div id="product-detail" class="card hidden">
        <img id="p-img" src="" alt="產品圖片" class="product-img">
        <h3 id="p-name"></h3>
        <p id="p-desc" style="color:#666; font-size:14px;"></p>
        <a id="p-link" href="#" target="_blank" class="buy-link">立即購買</a>
        <button class="btn" onclick="location.reload()" style="margin-top:30px; border:none; text-decoration:underline;">重新測驗</button>
    </div>
</div>

<script>
    // 1. 產品座標與資料 (已更新座標)
    const productData = {
        oil: [
            { name: "心靈淨化 (Purification of Mind)", x: 0.7, y: 0.7, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b940383a3a536e3e145ef/720x.webp?source_format=jpg", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96" },
            { name: "黑石 (BLACK STONE)", x: -0.6, y: 0.6, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b984396908c00103bf900/800x.webp?source_format=jpg", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96-1-1-1" },
            { name: "激情喚醒 (Passionate Awakening)", x: 0, y: 0.1, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b9658d7d596001420bed3/800x.webp?source_format=jpg", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96-1" },
            { name: "靜與能量 (Stillness and Energy)", x: -1, y: 0, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b97894c96220018871496/800x.webp?source_format=jpg", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96-1-1" },
            { name: "內田理央聯名款 (Velvet Touch)", x: -0.7, y: -0.7, img: "https://shoplineimg.com/68527c28c56c870042c966e9/690c1a6332300b0012686f16/800x.webp?source_format=jpg", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96-1-1-1-2" }
        ],
        room: [
            { name: "心靈淨化 (Purification of Mind)", x: 0.7, y: 0.7, img: "https://via.placeholder.com/400x400?text=Room-Purification", link: "https://sinnpurete.com/" },
            { name: "激情喚醒 (Passionate Awakening)", x: 0, y: 0.2, img: "https://via.placeholder.com/400x400?text=Room-Passionate", link: "https://sinnpurete.com/" },
            { name: "悟空好眠 (Dream Catcher)", x: -0.7, y: -0.2, img: "https://via.placeholder.com/400x400?text=Room-DreamCatcher", link: "https://sinnpurete.com/" }
        ],
        perfume: [
            { name: "追求幸福 (Pursuit of Happiness)", x: -0.4, y: 0.7, img: "https://via.placeholder.com/400x400?text=EDP-Happiness", link: "https://sinnpurete.com/" },
            { name: "黑石 (BLACK STONE)", x: -0.6, y: 0.6, img: "https://via.placeholder.com/400x400?text=EDP-BlackStone", link: "https://sinnpurete.com/" },
            { name: "感官與魅力 (Sense & Sensuality)", x: 0.6, y: 0.4, img: "https://via.placeholder.com/400x400?text=EDP-Sensuality", link: "https://sinnpurete.com/" },
            { name: "苦橙與歐白芷 (Bitter Orange & Angelica)", x: 0.55, y: 0, img: "https://via.placeholder.com/400x400?text=EDP-BitterOrange", link: "https://sinnpurete.com/" },
            { name: "無花果與無花果葉 (Fig & Fig Leaf)", x: -0.5, y: 0, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b9bbd544e9700111d2dfa/720x.webp?source_format=jpg", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96-1-1-1-1-1-1/" },
            { name: "黑莓與茉莉 (Blackberry & Jasmine)", x: -0.5, y: -0.7, img: "https://via.placeholder.com/400x400?text=EDP-Blackberry", link: "https://sinnpurete.com/" },
            { name: "內田理央聯名款 (Mandarin & Orange)", x: 0.7, y: -0.8, img: "https://via.placeholder.com/400x400?text=EDP-Mandarin", link: "https://sinnpurete.com/" }
        ]
    };

    const questions = [
        { text: "挑選這款香氣，是為了陪伴你什麼樣的時刻？", options: [{ t: "自我修護與按摩", type: "oil" }, { t: "空間氛圍切換", type: "room" }, { t: "展現個人氣場", type: "perfume" }] },
        { text: "「重要日子」的香水，你希望它帶給你什麼力量？", options: [{ t: "溫暖且亮眼的自信", x: -1 }, { t: "精緻且低調的平衡", x: 0 }, { t: "俐落且清新的專業", x: 1 }] },
        { text: "脆弱無助時，哪種氣息能像護身符般擁抱你？", options: [{ t: "沈穩的大地與木頭", y: 1 }, { t: "輕盈的草本與綠葉", y: 0 }, { t: "柔和優雅的花朵", y: -1 }] },
        { text: "想像一個屬於你的私密空間，牆面應該是什麼顏色？", options: [{ t: "暖黃或藕粉色", x: -1 }, { t: "純白或淺灰色", x: 0 }, { t: "冷藍或森林綠", x: 1 }] },
        { text: "哪個形容詞最符合你追求的靈魂狀態？", options: [{ t: "深邃與安定", y: 1 }, { t: "自由與靈動", y: 0 }, { t: "優雅與迷人", y: -1 }] }
    ];

    let currentStep = 0, scoreX = 0, scoreY = 0, selectedType = "";

    function startQuiz() {
        document.getElementById('start-page').classList.add('hidden');
        document.getElementById('quiz-page').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const q = questions[currentStep];
        document.getElementById('progress').innerText = `Step ${currentStep + 1} / 5`;
        document.getElementById('question-text').innerText = q.text;
        const container = document.getElementById('options-container');
        container.innerHTML = "";
        
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "btn";
            btn.innerText = opt.t;
            btn.onclick = () => {
                if (opt.type) selectedType = opt.type;
                if (opt.x !== undefined) scoreX += opt.x;
                if (opt.y !== undefined) scoreY += opt.y;
                currentStep++;
                if (currentStep < questions.length) showQuestion(); else showResult();
            };
            container.appendChild(btn);
        });
    }

    function showResult() {
        document.getElementById('quiz-page').classList.add('hidden');
        document.getElementById('result-page').classList.remove('hidden');

        // 1. 計算最近產品 (歐幾里得距離)
        const userX = scoreX / 2; // 將總分 -2~2 轉為 -1~1 比對座標
        const userY = scoreY / 2;
        let closest = null, minD = Infinity;

        productData[selectedType].forEach(p => {
            const d = Math.sqrt(Math.pow(userX - p.x, 2) + Math.pow(userY - p.y, 2));
            if (d < minD) { minD = d; closest = p; }
        });

        // 2. 圓點移動動畫 (百分比映射)
        setTimeout(() => {
            const dot = document.getElementById('target-dot');
            const leftPerc = ((scoreX + 2) / 4) * 80 + 10;
            const topPerc = 100 - (((scoreY + 2) / 4) * 80 + 10);
            dot.style.left = `${leftPerc}%`;
            dot.style.top = `${topPerc}%`;
        }, 300);

        // 3. 2.5秒後顯示詳細資訊並自動滑動
        setTimeout(() => {
            const detail = document.getElementById('product-detail');
            detail.classList.remove('hidden');
            document.getElementById('p-name').innerText = closest.name;
            document.getElementById('p-img').src = closest.img;
            document.getElementById('p-link').href = closest.link;
            document.getElementById('status-text').innerText = "找到最適合您的香氣了！";
            
            // 自動滑動到產品區
            detail.scrollIntoView({ behavior: 'smooth' });
        }, 2500);
    }
</script>

</body>
</html>