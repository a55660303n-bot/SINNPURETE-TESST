<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scent Finder | 香氛診斷</title>
    <style>
        :root { --primary-color: #333; }
        
        body { 
            font-family: "Optima", "serif", "Microsoft JhengHei";
            margin: 0;
            color: var(--primary-color);
            scroll-behavior: smooth;
            background: linear-gradient(135deg, #bcd3c4 0%, #EBEEE9 100%);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh; 
        }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }
        .hidden { display: none !important; }

        /* 調整測驗框框更圓角 */
        .card { 
            background: white; 
            padding: 50px 30px; 
            border-radius: 20px; /* 改為 20px 更有高級感 */
            box-shadow: 0 10px 40px rgba(0,0,0,0.05); 
            text-align: center; 
            position: relative; 
        }
        
        h2 { font-weight: 300; letter-spacing: 3px; margin-bottom: 20px; line-height: 1.4; }
        .btn { display: block; width: 100%; padding: 18px; margin: 12px 0; border: 1px solid #ddd; background: none; cursor: pointer; transition: 0.4s; font-size: 15px; border-radius: 10px; }
        .btn:hover { border-color: #000; background: #fbfbfb; }

        /* LOGO 樣式 (含連結) */
        .header-logo { position: absolute; top: 30px; left: 30px; z-index: 100; transition: opacity 0.3s; }
        .header-logo:hover { opacity: 0.7; }
        .header-logo img { height: 50px; width: auto; }

        @media (max-width: 600px) {
            .header-logo { top: 20px; left: 20px; }
            .header-logo img { height: 25px; }
        }

        /* 拱門封面 */
        .hero-image-container {
            margin: 30px auto; width: 200px; height: 280px;
            overflow: hidden; border-radius: 100px 100px 0 0; border: 1px solid #eee;
        }
        .arch-image { width: 100%; height: 100%; object-fit: cover; }

        /* 座標圖與文字 */
        .map-wrapper { position: relative; width: 300px; height: 300px; margin: 40px auto; background: #fff; background-size: cover; background-position: center; }
        .axis-label { position: absolute; font-size: 18px; font-weight: bold; color: #216250; white-space: nowrap; }

        .dot { 
            position: absolute; width: 14px; height: 14px; background: white; 
            border: 2px solid black; border-radius: 50%; transform: translate(-50%, -50%);
            transition: all 2s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 10;
        }

        /* 產品詳情 */
        .product-img { width: 100%; max-width: 300px; border-radius: 10px; margin: 20px 0; }

        /* 立即購買按鈕 + 跳動動畫 */
        .buy-link { 
            display: inline-block; 
            background: #000; 
            color: #fff; 
            padding: 15px 40px; 
            text-decoration: none; 
            margin: 20px 0; 
            border-radius: 5px;
            font-weight: bold;
            animation: pulse-animation 2s infinite; /* 啟動動畫 */
        }

        @keyframes pulse-animation {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(0, 0, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); }
        }

        /* 折扣碼樣式 */
        .coupon-section {
            margin: 30px auto; padding: 20px; border: 2px dashed #8c7851;
            background: #fffaf5; border-radius: 15px; width: 90%;
        }
        .coupon-code { font-size: 24px; font-weight: bold; color: #333; display: block; margin-bottom: 10px; letter-spacing: 2px; }
        .copy-btn { background: #8c7851; color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; }
        .expiry-text { font-size: 12px; color: #999; margin-top: 10px; }
    </style>
</head>
<body>

<a href="https://www.sinnpurete.com.tw/" target="_blank" class="header-logo">
    <img src="logo1.png" alt="Sinn Pureté Logo">
</a>

<div class="container">
    <div id="start-page" class="card">
        <h2>FIND YOUR SCENT</h2>
        <p>探索專屬於您的正念香氣</p>
        <div class="hero-image-container"><img src="cover.jpg" class="arch-image"></div>
        <button class="btn" onclick="startQuiz()" style="background:#000; color:#fff;">開始分析</button>
    </div>

    <div id="quiz-page" class="card hidden">
        <p id="progress" style="font-size:12px; color:#aaa;"></p>
        <h2 id="question-text"></h2>
        <div id="options-container"></div>
    </div>

    <div id="result-page" class="card hidden">
        <h2>FRAGRANCE MAP</h2>
        <div class="map-wrapper" id="map-bg">
            <div id="target-dot" class="dot" style="left: 50%; top: 50%;"></div>
            <div class="axis-label" style="top: -35px; left: 50%; transform: translateX(-50%);">木質調</div>
            <div class="axis-label" style="bottom: -35px; left: 50%; transform: translateX(-50%);">花香調</div>
            <div class="axis-label" style="left: -55px; top: 50%; transform: translateY(-50%);">甜美</div>
            <div class="axis-label" style="right: -55px; top: 50%; transform: translateY(-50%);">清爽</div>
        </div>
        <p id="status-text">正在計算您的專屬香氣...</p>

        <div id="product-detail" class="hidden" style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 30px;">
            <img id="p-img" src="" class="product-img">
            <h3 id="p-name"></h3>

            <div id="coupon-container" class="coupon-section">
                <p style="margin:0 0 10px 0; font-size:14px; color:#8c7851;">專屬結帳優惠碼</p>
                <span class="coupon-code" id="code-text">OFF10</span>
                <button class="copy-btn" onclick="copyCoupon()">點擊複製折扣碼</button>
                <p class="expiry-text">※ 2026/01/30 前有效，官網購買即享 10% OFF</p>
            </div>

            <a id="p-link" href="#" target="_blank" class="buy-link">使用折扣碼，立即購買</a>

            <button class="btn" onclick="location.reload()" style="border:none; text-decoration:underline; margin-top:20px;">重新測驗</button>
        </div>
    </div>
</div>

<script>
    const productData = {
        oil: [
            { name: "香氛多用油/心靈淨化 (Purification of Mind)", x: 0.7, y: 0.7, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b940383a3a536e3e145ef/720x.webp", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96" },
            { name: "香氛多用油/黑石 (BLACK STONE)", x: -0.6, y: 0.6, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b984396908c00103bf900/800x.webp", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96-1-1-1" }
        ],
        room: [
            { name: "無酒精正念香氛/心靈淨化 (Purification of Mind)", x: 0.7, y: 0.7, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688d8f8077978800121021b6/800x.webp", link: "https://www.sinnpurete.com.tw/products/%E7%84%A1%E9%85%92%E7%B2%BE%E6%AD%A3%E5%BF%B5%E9%A6%99%E6%B0%9Bpassionate-awakening%E6%BF%80%E6%83%85%E5%96%9A%E9%86%92-1" }
        ],
        perfume: [
            { name: "淡香精EDP/黑石 (BLACK STONE)", x: -0.6, y: 0.6, img: "https://shoplineimg.com/68527c28c56c870042c966e9/688b9e5274bec500105ca1e1/540x.webp", link: "https://www.sinnpurete.com.tw/products/%E9%A6%99%E6%B0%9B%E5%A4%9A%E7%94%A8%E6%B2%B9purification-of-mind-%E5%BF%83%E9%9D%88%E6%B7%A8%E5%8C%96-1-1-1-1-1-1-2-1-1" }
        ]
    };

    const questions = [
        { text: "挑選這款香氣，是為了陪伴你什麼樣的時刻？", options: [{ t: "自我修護與按摩", type: "oil" }, { t: "空間氛圍切換", type: "room" }, { t: "展現個人氣場", type: "perfume" }] },
        { text: "「重要日子」的香水，你希望它帶給你什麼力量？", options: [{ t: "溫暖且亮眼的自信", x: -1 }, { t: "精緻且低調的平衡", x: 0 }, { t: "俐落且清新的專業", x: 1 }] },
        { text: "脆弱無助時，哪種氣息能像護身符般擁抱你？", options: [{ t: "沈穩的大地與木頭", y: 1 }, { t: "輕盈的草本與綠葉", y: 0 }, { t: "柔和優雅的花朵", y: -1 }] },
        { text: "想像一個屬於你的私密空間，牆面應該是什麼顏色？", options: [{ t: "暖黃或藕粉色", x: -1 }, { t: "純白或淺灰色", x: 0 }, { t: "冷藍或森林綠", x: 1 }] },
        { text: "哪個形容詞最符合你追求的靈魂狀態？", options: [{ t: "深邃與安定", y: 1 }, { t: "自由與靈動", y: 0 }, { t: "優雅與迷人", y: -1 }] }
    ];

    let currentStep = 0, scoreX = 0, scoreY = 0, selectedType = "";

    function startQuiz() {
        document.getElementById('start-page').classList.add('hidden');
        document.getElementById('quiz-page').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const q = questions[currentStep];
        document.getElementById('progress').innerText = `Step ${currentStep + 1} / 5`;
        document.getElementById('question-text').innerText = q.text;
        const container = document.getElementById('options-container');
        container.innerHTML = "";
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "btn";
            btn.innerText = opt.t;
            btn.onclick = () => {
                if (opt.type) selectedType = opt.type;
                if (opt.x !== undefined) scoreX += opt.x;
                if (opt.y !== undefined) scoreY += opt.y;
                currentStep++;
                if (currentStep < questions.length) showQuestion(); else showResult();
            };
            container.appendChild(btn);
        });
    }

    function showResult() {
        document.getElementById('quiz-page').classList.add('hidden');
        document.getElementById('result-page').classList.remove('hidden');

        // 背景切換邏輯 (請確保 GitHub 上的檔名完全一致)
        const mapElement = document.getElementById('map-bg');
        let bgImage = "";
        if (selectedType === 'oil') bgImage = "香氛多用油香氛圖譜.jpg";
        else if (selectedType === 'room') bgImage = "MAP.jpg";
        else if (selectedType === 'perfume') bgImage = "淡香精圖譜.jpg";

        if (bgImage) {
            mapElement.style.backgroundImage = "url('" + bgImage + "')";
        }

        const userX = scoreX / 2; const userY = scoreY / 2;
        let closest = productData[selectedType][0];
        let minD = Infinity;
        productData[selectedType].forEach(p => {
            const d = Math.sqrt(Math.pow(userX - p.x, 2) + Math.pow(userY - p.y, 2));
            if (d < minD) { minD = d; closest = p; }
        });

        setTimeout(() => {
            const dot = document.getElementById('target-dot');
            dot.style.left = `${((scoreX + 2) / 4) * 80 + 10}%`;
            dot.style.top = `${100 - (((scoreY + 2) / 4) * 80 + 10)}%`;
        }, 300);

        setTimeout(() => {
            const detail = document.getElementById('product-detail');
            detail.classList.remove('hidden');
            document.getElementById('p-name').innerText = closest.name;
            document.getElementById('p-img').src = closest.img;
            document.getElementById('p-link').href = closest.link;
            document.getElementById('status-text').innerText = "為您尋得的專屬氣息：";
            checkCouponExpiry();
            detail.scrollIntoView({ behavior: 'smooth' });
        }, 2500);
    }

    function copyCoupon() {
        const code = document.getElementById('code-text').innerText;
        navigator.clipboard.writeText(code).then(() => {
            const btn = document.querySelector('.copy-btn');
            btn.innerText = "已複製！"; btn.style.background = "#28a745";
            setTimeout(() => { btn.innerText = "點擊複製折扣碼"; btn.style.background = "#8c7851"; }, 2000);
        });
    }

    function checkCouponExpiry() {
        const expiryDate = new Date('2026-01-31');
        if (new Date() >= expiryDate) document.getElementById('coupon-container').style.display = 'none';
    }
</script>
</body>
</html>

